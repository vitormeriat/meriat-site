<!DOCTYPE html>
<html>

  ﻿<head>
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-90757610-1', 'auto');
    ga('send', 'pageview');
  </script>

  <script type="text/javascript">
  var appInsights=window.appInsights||function(config){
    function i(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},u=document,e=window,o="script",s="AuthenticatedUserContext",h="start",c="stop",l="Track",a=l+"Event",v=l+"Page",y=u.createElement(o),r,f;y.src=config.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js";u.getElementsByTagName(o)[0].parentNode.appendChild(y);try{t.cookie=u.cookie}catch(p){}for(t.queue=[],t.version="1.0",r=["Event","Exception","Metric","PageView","Trace","Dependency"];r.length;)i("track"+r.pop());return i("set"+s),i("clear"+s),i(h+a),i(c+a),i(h+v),i(c+v),i("flush"),config.disableExceptionTracking||(r="onerror",i("_"+r),f=e[r],e[r]=function(config,i,u,e,o){var s=f&&f(config,i,u,e,o);return s!==!0&&t["_"+r](config,i,u,e,o),s}),t
    }({
        instrumentationKey:"d4823b90-66dc-43d1-84c6-7da8a3796ebd"
    });
    window.appInsights=appInsights;
    appInsights.trackPageView();
</script>

  <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Vitor Meriat</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Vitor Meriat" />
	<meta name="keywords" content="cloud computing, machine learning, big data, iot, developer, data scientist" />
	<meta name="author" content="Vitor Meriat" />

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="/assets/favicon.ico">

	<!-- Google Webfont -->
	<link href='https://fonts.googleapis.com/css?family=PT+Mono' rel='stylesheet' type='text/css'>
	<!-- Themify Icons -->
	<link rel="stylesheet" href="/assets/css/themify-icons.css">
	<!-- Icomoon Icons -->
	<link rel="stylesheet" href="/assets/css/icomoon-icons.css">
	<!-- Bootstrap -->
	<link rel="stylesheet" href="/assets/css/bootstrap.css">
	<!-- Owl Carousel -->
	<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
	<link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
	<!-- Magnific Popup -->
	<link rel="stylesheet" href="/assets/css/magnific-popup.css">
	<!-- Easy Responsive Tabs -->
	<link rel="stylesheet" href="/assets/css/easy-responsive-tabs.css">
	<!-- Theme Style -->
	<link rel="stylesheet" href="/assets/css/style.css?v1">

	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
	<link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/obsidian.css">

	<script>hljs.initHighlightingOnLoad();</script>

	<!-- FOR IE9 below -->
	<!--[if lte IE 9]>
	<script src="js/modernizr-2.6.2.min.js"></script>
	<script src="js/respond.min.js"></script>
	<![endif]-->
</head>


  <body>
    <!-- Header -->
	<header id="fh5co-header" role="banner">
		<div class="container">
      <div id="fh5co-logo">
				<a href="/">
					<img src="/assets/images/logo-d.png" alt="Work Logo">
				</a>
			</div>
      <div style="text-align: center;">
        <a href="/"><h2 style="margin-top: 0px !important;">Vitor Meriat</h2></a>
        <span style="font-size: 1em; color: black;">MVP Azure - Cloud Architect - Data science & Machine Learning Engineer</span>
      </div>
			<!-- Mobile Toggle Menu Button -->
			<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>

			<!-- Main Nav -->
			<div id="fh5co-main-nav">
				<nav id="fh5co-nav" role="navigation">
					<ul>
						<li class="">
							<a href="/">Blog</a>
						</li>
						<li class="">
							<a href="/archive/">Archives</a>
						</li>
            <li class="">
							<a href="/category/">Categories</a>
						</li>
            <li class="">
							<a href="/about/"> About me </a>
						</li>
					</ul>
					<!-- <a href="http://www.vitormeriat.com.br/" target="_blank" class="fh5co-nav-call-to-action js-fh5co-nav-call-to-action">Blog</a> -->
          <!-- <a href="/about/" class="">About me</a> -->
				</nav>
			</div>
			<!-- Main Nav -->
		</div>
	</header>
	<!-- Header -->
    <main role="main">
      <div class="container">
  <article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="row">
      <div class="fh5co-spacer fh5co-spacer-sm"></div>
      <div class="col-md-12 text-center">
        <h1>Azure Mobile Service–Logging local e na nuvem com backend .NET WebAPI</h1>
        
      </div>
      
        <h2 class="fh5co-uppercase-heading-sm text-center">
          Microsoft Azure &amp; WebAPI
        </h2>
      
      <span><time datetime="2014-09-05T00:00:00-03:00" itemprop="datePublished">Sep 5, 2014</time></span>
    </div>
    <div class="fh5co-spacer fh5co-spacer-md"></div>
    <section class="section-padding post" itemprop="articleBody">
      <p align="justify">Um dos pontos de maior adoção ao <strong>backend .NET WebAPI</strong> para o serviços mobile do Microsoft Azure, é a facilidade de testar localmente. Fora isso, Se comparado a arquitetura do <strong>backend NodeJS</strong> temos muito mais capacidade em realizar debug e auditoria em nossa aplicação.</p>
<p><img alt="fig04" src="http://blob.vitormeriat.com.br/images/2014/09/fig04.png" width="100%" /></p>
<p>Neste post vou exemplificar como utilizar o mecanismo de log do <strong>Microsoft Azure Mobile Services</strong> com backend .NET WebAPI local e na nuvem de forma rápida e simples.</p>
<p><!--more-->
<p align="justify">O primeiro passo e criar um serviço mobile caso você ainda não o tenha feito. Essa é uma tarefa realmente muito simples porém se você nunca o fez pode se&#160; basear no artigo anterior: <a href="http://vitormeriat.com.br/2014/08/12/azure-mobile-service-primeiros-passos-com-backend-net-webapi/" target="_blank">Azure Mobile Service – Primeiros passos com backend .NET WebAPI</a>. </p>
<p align="justify">Neste artigo vou utilizar o mesmo serviço que havia criado no artigo anterior. Para isso vou no portal de gestão do Microsoft Azure, acesso meu serviço (no caso meriatwebapi) e acessando a nuvenzinha azul clico em <strong>CONNECT AN EXISTING WINDOWS OR WINDOWS PHONE APP</strong>. Será baixado um serviço com o exemplo ToDo já implementado, como o descrito anteriormente.</p>
<p align="justify">Vamos iniciar implementando o LOG para os testes locais. Para isso acesse a classe TodoItemController na pasta Controllers, e insira os seguintes códigos nos métodos GetAllTodoItems e GetTodoItem respectivamente: </p>
<ul>
<li>this.Services.Log.Info(&quot;[GetAllTodoItems] GET all items&quot;); </li>
<li>this.Services.Log.Info(&quot;[GetTodoItem] GET item: &quot; + id ?? &quot;&lt;&lt;no id&gt;&gt;&quot;); </li>
</ul>
<p>O seu código deve ficar assim:</p>
<p><img alt="FIG02" src="http://blob.vitormeriat.com.br/images/2014/09/fig02.png" width="100%" /></p>
<p>Simples assim… <strong>Habemus LOG!!!</strong></p>
<p align="justify">Vale notar que o LOG é uma propriedade de <strong>ApiServices</strong> do WindowsAzure.Mobile.Service, e que está acessível em <strong>TableController&lt;T&gt;</strong>.</p>
<p><img alt="FIG03" src="http://blob.vitormeriat.com.br/images/2014/09/fig03.png" width="100%" /></p>
<p>&#160;</p>
<h2>Rodando Local</h2>
<p>Executando o a aplicação localmente, podemos observar os Logs de duas maneiras:</p>
<ul>
<li>Debugando a aplicação e visualizando no Console Output </li>
<li>Gravando o LOG fisicamente </li>
</ul>
<p><strong><font size="4">Console Output</font></strong></p>
<p align="justify">Apenas rode sua aplicação com o&#160; famoso “<strong>F5</strong>”. Atache um <strong>breakpoint</strong> no <strong>GetAllTodoItems</strong>. Note que seu serviço vai executar no <strong>localhost</strong>. Ai é só realizar o get (<strong>localhost:{sua-porta}/tables/TodoItem</strong>).</p>
<p><img title="FIG04" alt="FIG04" src="http://blob.vitormeriat.com.br/images/2014/09/fig04.png" width="100%" /></p>
<p>Já na aplicação, abra a console <strong>Output</strong> e execute os próximos passos até o <strong>LOG</strong>.</p>
<p><img alt="FIG05" src="http://blob.vitormeriat.com.br/images/2014/09/fig05.png" width="100%" /></p>
<p align="justify">Como podemos ver, o <strong>LOG</strong> vai ser exibido na console <strong>Output</strong>. É claro que nem sempre estamos debugando a aplicação, mesmo que rodando localmente. Isso nos leva a segunda solução:</p>
<p><strong><font size="4">Gravando o LOG fisicamente</font></strong></p>
<p align="justify">Neste ponto vamos gravar um arquivo txt em algum lugar. Não tem nada de novo nisso. Vamos apenas criar um um diagnostico para concatenar os logs em um arquivo texto. Para isso vamos alterar nosso <strong>Web.config</strong> incluindo o seguinte código:</p>
<blockquote><p><strong><font size="2">&lt;system.diagnostics&gt;  <br />&#160;&#160;&#160; &lt;trace autoflush=&quot;true&quot;&gt;   <br />&#160;&#160;&#160;&#160;&#160; &lt;listeners&gt;   <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;add name=&quot;default&quot; initializeData=&quot;C:developmentmylog.txt&quot;   <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; type=&quot;System.Diagnostics.TextWriterTraceListener&quot; /&gt;   <br />&#160;&#160;&#160;&#160;&#160; &lt;/listeners&gt;   <br />&#160;&#160;&#160; &lt;/trace&gt;   <br />&#160; &lt;/system.diagnostics&gt;</font></strong></p>
</blockquote>
<p>Seu config vai ficar como o descrito abaixo:</p>
<p><img alt="FIG06" src="http://blob.vitormeriat.com.br/images/2014/09/fig06.png" width="100%" /></p>
<p align="justify">Neste caso estou definindo que meus logs devem ser gravados em um arquivo chamado <strong>mylog.txt</strong> na pasta <strong>development</strong> no meu diretório <strong>C</strong>. Executando novamente a aplicação e executando os métodos <strong>GetAllTodoItems</strong> (http://localhost:50269/tables/TodoItem) e <strong>GetTodoItem</strong> (http://localhost:50269/tables/TodoItem/1) vamos ter o seguinte:</p>
<p><img alt="FIG07" src="http://blob.vitormeriat.com.br/images/2014/09/fig07.png" width="100%" /></p>
<p>&#160;</p>
<h2>Rodando na Nuvem</h2>
<p align="justify">Esse é realmente simples. Só precisamos publicar as alterações do nosso serviço. Para isso basta clicar com o botão direito no projeto e clicar em <strong>Publish</strong>.</p>
<p><img alt="fig01" src="http://blob.vitormeriat.com.br/images/2014/09/fig01.png" width="100%" /></p>
<p>Na tela que se segue selecione a opção Microsoft Azure Mobile Services.</p>
<p><img alt="fig02" src="http://blob.vitormeriat.com.br/images/2014/09/fig02.png" width="100%" /></p>
<p>Neste momento será realizado sua autorização e será listados todos os seus serviços bem como a opção de criar um novo serviço para o deploy da aplicação.</p>
<p><img alt="fig03" src="http://blob.vitormeriat.com.br/images/2014/09/fig03.png" width="100%" /></p>
<p align="justify">Em nosso caso vamos apenas selecionar o serviço correspondente e realizar o <strong>Publish</strong>.</p>
<p align="justify">Pronto!!! Após a finalização do processo o navegador será aberto na página inicial do nosso serviço hospedado na nuvem. Agora é só realizar o mesmo procedimento dos testes locais.</p>
<p align="justify">No meu caso a execução foi:</p>
<ul>
<li>https://meriatwebapi.azure-mobile.net/tables/TodoItem </li>
<li>https://meriatwebapi.azure-mobile.net/tables/TodoItem/1 </li>
</ul>
<p><img alt="fig06" src="http://blob.vitormeriat.com.br/images/2014/09/fig06.png" width="100%" /></p>
<p>Para o resultado é só acessar a aba LOGS para visualizar.</p>
<p><img alt="fig05" src="http://blob.vitormeriat.com.br/images/2014/09/fig05.png" width="100%" /></p>
<p align="justify"><strong>PS:</strong> Vale notar que ao executar na nuvem será solicitado sua autenticação no brwoser. É só informar seu usuário da subscription (o nome antes do @ no e-mail de acesso ao portal), e a chave do serviço.</p>
<p>&#160;</p>
<p align="justify">Esta é só a introdução e serve de base para que você possa realizar suas implementações necessárias a fim de gerar todos os seus LOGS. </p>
<p>&#160;</p>
<h2>Referências:</h2>
<p><a href="http://azure.microsoft.com/blog/2014/07/28/azure-mobile-services-net-updates/">http://azure.microsoft.com/blog/2014/07/28/azure-mobile-services-net-updates/</a></p>
<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/dn629482.aspx">http://msdn.microsoft.com/en-us/library/windows/apps/xaml/dn629482.aspx</a></p>
<h6></h6>
<h2><font color="#d19049">Bons estudos e até a próxima pessoal&#160; ;)</font></h2>
</p>

    </section>
  </article>

  <hr/>
  <section class="author">
  	<header> <a href=""> <img class="profile" src="/assets/images/profile.jpg" alt="Author's profile picture"></a></header>
  	<article>
  		<!-- Author Name -->
      	<h4>  </h4>
      	<!-- Author Bio -->
      	<p>
      		Vitor is a computer scientist who is passionate about creating software that will positively change the world we live in.
      	</p>
        <p>
          MVP Azure - Cloud Architect - Data science enthusiast
        </p>
      </article>
  </section>
  <hr/>

  <div style="margin-top: 60px; margin-bottom: 60px;">
    
    
      4 minutes to read
    
  </div>

  <div class="PageNavigation">
  
    <a class="prev" href="/2014/09/03/etbs-2014-cloud-computing-servios-e-mobilidade-com-microsoft-azure/"><i class="fa fa-lg fa-arrow-left"></i> ETBS 2014 - Cloud Computing, Serviços e Mobilidade com Microsoft Azure</a>
  
  
    <a class="next" href="/2014/09/11/azure-mobile-servicegerenciando-logs-deploy-e-o-projeto-kudu/">Azure Mobile Service–Gerenciando Logs, deploy e o projeto Kudu <i class="fa fa-lg fa-arrow-right"></i></a>
  
  </div>
</div>
<div style="height: 80px;"></div>

    </main>

    <footer id="fh5co-footer" role="contentinfo">
	<div class="container">
		<div class="row">
			<div class="col-md-12" style="text-align: right;">
				<ul class="fh5co-footer-social">
					<li><a href="https://twitter.com/vitormeriat" target="_blank"><i class="fa fa-twitter fa-1x"></i> Twitter</a></li>
					<li><a href="https://github.com/vitormeriat" target="_blank"><i class="fa fa-github fa-1x"></i> Github</a></li>
					<li><a href="https://www.linkedin.com/in/vitormeriat" target="_blank"><i class="fa fa-linkedin fa-1x"></i> LinkedIn</a></li>
					<li><a href="https://www.instagram.com/vitormeriat/" target="_blank"><i class="fa fa-instagram fa-1x"></i> Instagram</a></li>
					<li><a href="https://www.facebook.com/vitormeriat/" target="_blank"><i class="fa fa-facebook fa-1x"></i> Facebook</a></li>
					<li><a href="https://www.youtube.com/user/vitormeriat/" target="_blank"><i class="fa fa-youtube fa-1x"></i> Youtube</a></li>
				</ul>
				<p class="fh5co-copyright">
					<small>(c) 2017 <a href="/">Meriat's</a>. All Rights Reserved.
					</small>
				</p>
			</div>
		</div>
	</div>
</footer>

	<!-- Go To Top -->
	<a href="#" class="fh5co-gotop"><i class="ti-shift-left"></i></a>

	<!-- jQuery -->
	<script src="/assets/js/jquery-1.10.2.min.js"></script>
	<!-- jQuery Easing -->
	<script src="/assets/js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="/assets/js/bootstrap.js"></script>
	<!-- Owl carousel -->
	<script src="/assets/js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
 <script src="/assets/js/jquery.magnific-popup.min.js"></script>
	<!-- Easy Responsive Tabs -->
	<script src="/assets/js/easyResponsiveTabs.js"></script>
	<!-- FastClick for Mobile/Tablets -->
	<script src="/assets/js/fastclick.js"></script>
	<!-- Velocity -->
	<script src="/assets/js/velocity.min.js"></script>
	<!-- Main JS -->
	<script src="/assets/js/main.js"></script>


  </body>
</html>
