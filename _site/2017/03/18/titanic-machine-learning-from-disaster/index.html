<!DOCTYPE html>
<html>

  ﻿<head>
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-90757610-1', 'auto');
    ga('send', 'pageview');
  </script>

  <script type="text/javascript">
  var appInsights=window.appInsights||function(config){
    function i(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},u=document,e=window,o="script",s="AuthenticatedUserContext",h="start",c="stop",l="Track",a=l+"Event",v=l+"Page",y=u.createElement(o),r,f;y.src=config.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js";u.getElementsByTagName(o)[0].parentNode.appendChild(y);try{t.cookie=u.cookie}catch(p){}for(t.queue=[],t.version="1.0",r=["Event","Exception","Metric","PageView","Trace","Dependency"];r.length;)i("track"+r.pop());return i("set"+s),i("clear"+s),i(h+a),i(c+a),i(h+v),i(c+v),i("flush"),config.disableExceptionTracking||(r="onerror",i("_"+r),f=e[r],e[r]=function(config,i,u,e,o){var s=f&&f(config,i,u,e,o);return s!==!0&&t["_"+r](config,i,u,e,o),s}),t
    }({
        instrumentationKey:"d4823b90-66dc-43d1-84c6-7da8a3796ebd"
    });
    window.appInsights=appInsights;
    appInsights.trackPageView();
</script>

  <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Vitor Meriat</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Vitor Meriat" />
	<meta name="keywords" content="cloud computing, machine learning, big data, iot, developer, data scientist" />
	<meta name="author" content="Vitor Meriat" />

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="/assets/favicon.ico">

	<!-- Google Webfont -->
	<link href='https://fonts.googleapis.com/css?family=PT+Mono' rel='stylesheet' type='text/css'>
	<!-- Themify Icons -->
	<link rel="stylesheet" href="/assets/css/themify-icons.css">
	<!-- Icomoon Icons -->
	<link rel="stylesheet" href="/assets/css/icomoon-icons.css">
	<!-- Bootstrap -->
	<link rel="stylesheet" href="/assets/css/bootstrap.css">
	<!-- Owl Carousel -->
	<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
	<link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
	<!-- Magnific Popup -->
	<link rel="stylesheet" href="/assets/css/magnific-popup.css">
	<!-- Easy Responsive Tabs -->
	<link rel="stylesheet" href="/assets/css/easy-responsive-tabs.css">
	<!-- Theme Style -->
	<link rel="stylesheet" href="/assets/css/style.css?v1">

	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
	<link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/obsidian.css">

	<script>hljs.initHighlightingOnLoad();</script>

	<!-- FOR IE9 below -->
	<!--[if lte IE 9]>
	<script src="js/modernizr-2.6.2.min.js"></script>
	<script src="js/respond.min.js"></script>
	<![endif]-->
</head>


  <body>
    <!-- Header -->
	<header id="fh5co-header" role="banner">
		<div class="container">
      <div id="fh5co-logo">
				<a href="/">
					<img src="/assets/images/logo-d.png" alt="Work Logo">
				</a>
			</div>
      <div style="text-align: center;">
        <a href="/"><h2 style="margin-top: 0px !important;">Vitor Meriat</h2></a>
        <span style="font-size: 1em; color: black;">MVP Azure - Cloud Architect - Data science enthusiast</span>
      </div>
			<!-- Mobile Toggle Menu Button -->
			<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>

			<!-- Main Nav -->
			<div id="fh5co-main-nav">
				<nav id="fh5co-nav" role="navigation">
					<ul>
						<li class="">
							<a href="/">Blog</a>
						</li>
						<li class="">
							<a href="/archive/">Archives</a>
						</li>
            <li class="">
							<a href="/category/">Categories</a>
						</li>
            <li class="">
							<a href="/about/"> About me </a>
						</li>
					</ul>
					<!-- <a href="http://www.vitormeriat.com.br/" target="_blank" class="fh5co-nav-call-to-action js-fh5co-nav-call-to-action">Blog</a> -->
          <!-- <a href="/about/" class="">About me</a> -->
				</nav>
			</div>
			<!-- Main Nav -->
		</div>
	</header>
	<!-- Header -->
    <main role="main">
      <div class="container">
  <article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="row">
      <div class="fh5co-spacer fh5co-spacer-sm"></div>
      <div class="col-md-12 text-center">
        <h1>Kaggle Competition - Titanic: Machine Learning from Disaster</h1>
        
      </div>
      
        <h2 class="fh5co-uppercase-heading-sm text-center">
          IA &amp; Machine Learning &amp; Data Science &amp; Deep Learning &amp; Jupyter Notebook &amp; Python
        </h2>
      
      <span><time datetime="2017-03-18T00:00:00-03:00" itemprop="datePublished">Mar 18, 2017</time></span>
    </div>
    <div class="fh5co-spacer fh5co-spacer-md"></div>
    <section class="section-padding post" itemprop="articleBody">
      <p><img style="width: 100%;" src="http://blob.vitormeriat.com.br/images/2017/03/18/capa.jpg" class="absolute-bg" /></p>

<p>O <strong>Projeto Titanic</strong> é uma competição de <strong>Data Science</strong> promovida pelo <a href="kaggle.com">Kaggle.com</a>. O objetivo deste desafio é deduzir os índices de sobrevivência dos passageiros do Titanic.</p>

<p>Meu objetivo aqui é resumir de forma simples este problema e como chegar a sua solução, aproveitando para introduzir alguns dos conceitos envolvido no tão falado <strong>Machine Learning</strong>. Não vou me aprofundar em nenunhum ponto, espero embreve fazê-lo com mais tempo e foco.</p>

<p>Este é um dos problemas iniciais favoritos dos estudantes de Data Science, e tem um dataset com a complexidade ideal para explorar alguns problemas que funcionam de pano de fundo para introduzir os conceitos de Machine Learning mais básicos.</p>

<h2 id="agenda">Agenda</h2>

<ul>
  <li>Introdução</li>
  <li>Os dados</li>
  <li>Descobrindo Padrões</li>
  <li>Exploratory Data Analysis
    <ul>
      <li>Missing Data
        <ul>
          <li>Embarked</li>
          <li>Fare</li>
          <li>Age</li>
          <li>Name</li>
        </ul>
      </li>
      <li>Feature Engineering
        <ul>
          <li>Title</li>
          <li>Cabin</li>
          <li>Surname</li>
          <li>Family Size</li>
        </ul>
      </li>
      <li>Data Transformation</li>
      <li>Feature Selection</li>
      <li>Feature selection</li>
    </ul>
  </li>
</ul>

<h2 id="introdução">Introdução</h2>

<p>Para quem assiste os <a href="https://www.youtube.com/watch?v=JVgkvaDHmto">Mythbusters</a>, sabe que em um de seus programas o assunto do Titanic foi mais do explorado. Não como iremos fazer aqui, já que o foco era provar que era possível Jack e Rose terem sobrevivido utilizando a porta flutuante.</p>

<blockquote>
  <p>Nosso foco entretanto, é medir a chance real de sobrevivência dos passageiros a bordo do Titanic em 14 de abril de 1912.</p>
</blockquote>

<p>A história do Titanic é muito conhecida, tendo originado diversos livros, filmes, HQs e afins. É válido lembrar que a história narrada de forma célebre por James Cameron em seu filme de 1997, ilustra perfeitamente o motivo deste desafio. Vamos começar com uma breve perspectiva sobre o tema: Em Abril de 1912 o Titanic zarpou rumo a New York com <code>2224</code> passageiros, dos quais estima-se que apenas <code>710</code> tenham sobrevivido.</p>

<p>É aqui que entra nosso desafio: Desenvolver um padrão simples para identificar o perfil dos sobreviventes deste desastre.</p>

<blockquote>
  <p>Nota: Muitos dos barcos salva-vidas não estavam com a sua capacidade máxima de pessoas a bordo. Se estivessem, seria possível salvar <code>53,4%</code> dos passageiros, mas apenas <code>31,6%</code> deles sobreviveram.</p>
</blockquote>

<p>Neste caso não temos complicação com elementos aleatórios de sorte. A maioria dos sobreviventes eram mulheres, crianças e pessoas da alta sociedade.</p>

<h2 id="os-dados">Os dados</h2>

<p>A lista de sobreviventes e não sobreviventes foi transformada em dois datasets, <strong>train.csv</strong> e <strong>test.csv</strong>. Existe apenas uma diferença entre os dois arquivos, a lista de status de sobrevivência que está presente apenas nos dados de <strong>treino</strong>. Nos dados de teste este valor precisa ser deduzido.</p>

<blockquote>
  <p>Todos os aprendizados começam com uma experiência e são um processo contínuo. Raramente tem um ponto final. Todos os aprendizados são apenas uma aproximação.</p>
</blockquote>

<p>Geralmente trabalhamos um experimento utilizando dois conjuntos de dados. Um de treino e um para o teste, tipicamente dividido em 80% ou 70% para treino e e restante para o teste.</p>

<p>A aprendizagem acontece usando o <code>Conjunto A</code> e a validação acontece usando o <code>Conjunto B</code>. Uma vez que a aprendizagem é aperfeiçoada, aplicamos nosso modelo nos dados de teste. Vale lembrar que não temos o conhecimento do estado de sobrevivência do passageiro nos dados do teste.</p>

<p>Neste desafio vamos utilizar os dados disponíveis no próprio site do Kaggle para desenvolver nosso modelo, a fim de prever as taxas de sobrevivência para os passageiros do Titanic.</p>

<p>O conjunto de teste conta com 418 passageiros e o conjunto de treinamento é composto por 891 passageiros. O dataset é composto por:</p>

<ul>
  <li><code>PassengerId</code>: Número de identificação do passageiro;</li>
  <li><code>Survived</code>: Indica se o passageiro sobreviveu ao desastre. É atribuído o valor de 0 para aqueles que não sobreviveram, e 1 para quem sobreviveu;</li>
  <li><code>Pclass</code>: Classe na qual o passageiro viajou. É informado 1 para primeira classe; 2 para segunda; e 3 para terceira;</li>
  <li><code>Name</code>: Nome do passageiro;</li>
  <li><code>Sex</code>: Sexo do passageiro;</li>
  <li><code>Age</code>: Idade do passageiro em anos;</li>
  <li><code>SibSp</code>: Quantidade de irmãos e cônjuges a bordo;</li>
  <li><code>Parch</code>: Quantidade de pais e filhos a bordo;</li>
  <li><code>Ticket</code>: Número da passagem;</li>
  <li><code>Fare</code>: Preço da passagem;</li>
  <li><code>Cabin</code>: Número da cabine do passageiro;</li>
  <li><code>Embarked</code>: Indica o porto no qual o passageiro embarcou. Há apenas três valores possíveis: Cherbourg, Queenstown e Southampton, indicados pelas letras <strong>C</strong>, <strong>Q</strong> e <strong>S</strong>, respectivamente.</li>
</ul>

<p>Como na maioria das competições Kaggle, você recebe dois conjuntos de dados:</p>

<ul>
  <li>Um conjunto de treino completo com o resultado (outcome ou target variable), para um grupo de passageiros, bem como uma coleção de outros parâmetros, como sua idade, sexo, etc. Este é o conjunto de dados em que você deve treinar seu modelo preditivo.</li>
  <li>Um conjunto de teste, para o qual você deve prever a variável de destino agora desconhecida com base nos outros atributos de passageiros que são fornecidos para ambos os conjuntos de dados.</li>
</ul>

<p>Este é um ótimo ponto de entrada para aprender machine learning com um conjunto de dados pequeno, gerenciável, interessante e com variáveis ​​de fácil compreensão.</p>

<p align="center"><img src="http://blob.vitormeriat.com.br/images/2017/03/18/ml-pattern.png" /></p>

<h1 id="descobrindo-padrões">Descobrindo padrões</h1>

<p>A tragédia do “Titanic” está associada com a regra não escrita do salvamento no mar: “mulheres e crianças primeiro”.</p>

<p>Nesta tarefa, os competidores precisam analisar a probabilidade de sobrevivência das diferentes categorias de passageiros.</p>

<p>Vamos estipular o sexo dos passageiros e tripulantes. Este é um  dado importante, uma vez que o sexo do passageiro desempenha um papel crucial para determinar a sobrevivência do mesmo. Um simples count revela que temos 891 passageiros dos quais 65% são homens e 35% são mulheres.</p>

<table class="table-fill">
  <tbody>
    <tr>
      <th>Gender</th>
      <th>Count of Passengers</th>
      <th> % </th>
    </tr>
    <tr>
      <td>female</td>
      <td>314</td>
      <td>35%</td>
    </tr>
    <tr>
      <td>male</td>
      <td>577</td>
      <td>65%</td>
    </tr>
  </tbody>
</table>

<p>Se adicionarmos a taxa de sobrevivência a equação vamos ver que existe um padrão aqui.</p>

<table class="table-fill">
  <tbody>
    <tr>
      <th>Count of Passengers</th>
      <th>Survived Status</th>
      <th> </th>
      <th> </th>
    </tr>
    <tr>
      <td style="background: #63dd69; color: white;">Gender</td>
      <td style="background: #63dd69; color: white;">Not Survived</td>
      <td style="background: #63dd69; color: white;">Survived</td>
      <td style="background: #63dd69; color: white;">Total</td>
    </tr>
    <tr>
      <td>female</td>
      <td>81</td>
      <td>233</td>
      <td>314</td>
    </tr>
    <tr>
      <td>male</td>
      <td>468</td>
      <td>109</td>
      <td>577</td>
    </tr>
    <tr>
      <td style="background: #777777; color: white;">Total</td>
      <td style="background: #777777; color: white;">549</td>
      <td style="background: #777777; color: white;">342</td>
      <td style="background: #777777; color: white;">891</td>
    </tr>
  </tbody>
</table>

<p>O seguinte pode ser observado a partir dos dados acima:</p>

<ol>
  <li>62% (549/891) dos passageiros não sobreviveram</li>
  <li>38% (342/891) sobreviveram</li>
</ol>

<p>Dos 38% que sobreviveram, os passageiros do sexo feminino sobreviveram em maior número maior que os passageiros do sexo masculino.</p>

<ol>
  <li>De todos os passageiros do sexo feminino (233/314) 74% sobreviveram</li>
  <li>De todos os passageiros do sexo masculino (109/577), apenas 19% sobreviveram</li>
</ol>

<p>Podemos ilustrar este comportamento usando uma árvore de decisão. Cada nó determina o resultado final com base na maioria. Os votos do nó à direita representam o status de sobrevivência, já que a maioria nesta opção sobreviveu. Os votos do à esquerda representam o status de não sobrevivência, uma vez que a maioria não sobreviveu.</p>

<p align="center"><img src="http://blob.vitormeriat.com.br/images/2017/03/18/ml-pattern-all.png" /></p>

<p>Este é nosso primeiro padrão. Par facilitar vamos conceituar algumas coisas: O dataset de treino é chamado de <strong>labelled dataset</strong>, onde a coluna <u>Survived</u> é chamda de “label” ou <strong>response data</strong>. Esta abordagem é chamada de aprendizagem supervisionada, onde aprendemos com os dados de treino e aplicamos este aprendizado nos dados de teste. O resultado desta abordagem é binária, portanto estamos aplicando uma técnica de classificação, utilizando duas classes, a saber, <strong>survived</strong> ou <strong>not survived</strong>.</p>

<p>Vamos nos referir ao conjunto de dados progressivamente ao longo deste post, começar a descobrir o conceito de aprendizagem da máquina e suas dimensões variadas. Como você pode observar a partir dos dados, os passageiros e seus atributos compõem os dados do Titanic.</p>

<div style="margin-bottom: 5em; margin-top: 4em; background-color: #dcbc14; color: #382d2d">
<p style="padding: 1.6em; font-family: courier;">
Um ponto importante sobre este tutorial: Não estou colocando todo o passo a passo da solução. Aqui não temos os passos para importação de dados e etc. Estou focando na solução técnica para a criação do modelo e resolução do problema. Para ver a solução completa que inclusive enviei para o Kaggle, você deve ver o código que está na sessão entitulada, <u><b>O repositório</b></u>
</p>
</div>

<hr style="margin-bottom: 3em;" />

<h2 id="exploratory-data-analysis">Exploratory Data Analysis</h2>

<p>Em nossa fase de <strong>análise exploratória de dados</strong>, precisamos conhecer nossos dados e compreender sua qualidade para conseguir realizar nossa predição.</p>

<p>Neste ponto vamos combinar os dados de teste de treino antes de realizar qualquer tipo de análise exploratória. Este propósito ficará mais claro em breve. Por hora vamos combinar os 2 conjuntos de dados, e para que isso seja possível precisamos criar uma coluna adicional no conjunto de teste chamado <code>Survived</code> e marcá-los todos com <code>-1</code>, a fim de que sejamos capazes de distinguir em um ponto posterior no tempo os dados de teste. Também há uma necessidade de reorganizar as colunas nos dados de treino para refletir o posicionamento dos dados de teste.</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 testTitanicDS.is_copy = False
 testTitanicDS['Survived']=-1
 trainTitanicDS =  trainTitanicDS[['PassengerId','Pclass','Name','Sex','Age','SibSp','Parch','Ticket','Fare','Cabin','Embarked','Survived']]
 mergedTitanicDS = trainTitanicDS.append(testTitanicDS)
    </code>
</pre>

<h2 id="missing-data">Missing Data</h2>

<p>A falta de dados deve ser tratada antes de se aplicar qualquer algoritmo de aprendizado de máquina. Isso faz sentido já que se tivermos dados faltando em alguma linha, nosso resultado pode ser afetado. No código abaixo vamos procurar e exibir os dados de valores missing caso eles existam em nosso dataset.</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 for col in mergedTitanicDS:
    if mergedTitanicDS[col].isnull().sum()&gt;0:
        print("Missing Values in %s %d" % (col,(mergedTitanicDS[col].isnull().sum())))
    </code>
</pre>

<p>Como resultado temos a seguinte saída:</p>

<pre><code>***** output *****

Missing Values in Age 263
Missing Values in Fare 1
Missing Values in Cabin 1014
Missing Values in Embarked 2
</code></pre>
<p>Sendo assim já sabemos que existem muitos valores missing em nosso dataset. Uma vez que os identificamos o próximo passo é examinar para entender qual o motivo ou causa para esse comportamento. Em Machine Learning, os dados são essenciais, e como tal, devemos olhar com toda atenção.</p>

<p>Existem diversas técnicas para lidar como valores missing. Uma delas seria eliminar toda a linha e trabalhar somente com as linhas contendo dados completos. Em nosso caso vamos atacar cada um dos recursos em falta e definir qual estratégia usar. Vamos iniciar pelo mais simples.</p>

<h4 id="embarked">Embarked</h4>

<p>Podemos nota que existem apenas 2 valores missing para Embarked. Vamos observar sua distribuição:</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 mergedTitanicDS['Embarked'].value_counts()
    </code>
</pre>

<pre><code>***** output *****

S    914
C    270
Q    123
Name: Embarked, dtype: int64
</code></pre>

<p>Bem vindo as variáveis categóricas. Temos pouca massa de manobra aqui. Uma estratégia consistente neste caso poderia ser substituir os valores missing pelo valor de <code>S</code>, já que o mesmo supera tanto <code>C</code> quanto <code>Q</code> em termos de númericos. Com esta abordagem estamos influenciando muito pouco no resultado final.</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 mergedTitanicDS.is_copy = False
 mergedTitanicDS.loc[mergedTitanicDS['Embarked'].isnull(),'Embarked'] = 'S'
    </code>
</pre>

<h4 id="fare">Fare</h4>

<p>Há apenas um passageiro com dados missing sobre a tarifa. O passageiro em questão é senhor <strong>“Storey, Mr. Thomas”</strong>. Se olharmos para os dados do senhor Thomas, veremos que ele viajou na classe <code>Pclass 3</code>.</p>

<p>Neste caso podemos usar como estratégia, obter a média da tarifa paga pelos passageiros da classe <strong>Pclass 3</strong>.</p>

<pre style="font-size: 1em !important">
    <code class="python">
 mergedTitanicDS_Merged.loc[
 	mergedTitanicDS_Merged['Fare'].isnull(),'Fare'] = 
 	mergedTitanicDS_Merged[mergedTitanicDS_Merged['Pclass'] == 3]['Fare'].mean()
    </code>
</pre>

<div style="margin-bottom: 4em; margin-top: 4em; background-color: #dcbc14; color: #382d2d">
<p style="padding: 1.6em; font-family: courier;">
<b style="font-size: 1.8em">Think outside the box</b><br />Esta é uma fase muito importante. Geralmente você vai se deparar com situações durante o tratamento de dados em que vai parecer impossível realziar um tratamento. Um exemplo disso em nosso projeto é a feature <u><b>AGE</b></u>
</p>
</div>

<h4 id="age">Age</h4>

<p>A idade é um ponto de dados contínuo. Há <code>263</code> valores missing, o que representa cerca de <code>19%</code> dos dados. Existem várias estratégias para substituição da idade, o mais simples é substituir por uma média, mediana ou moda.</p>

<p>A <strong>armadilha</strong> nesta estratégia é que todos os passageiros sem idade terão o mesmo valor estático, o que pode resultar em uma criança com a idade de um adulto, sendo assim, essa abordagem irá afetar diretamente no resultado final, tornando nossa privisão falha.</p>

<p>Como resolver este problema de forma satisfatória? Podemos começar olhando para o nosso dataset a fim de achar algo que nos ajude…</p>

<h4 id="name">Name</h4>

<p>Opa… <strong>Name</strong> não possui valores missing, então o que está fazendo aqui? A questão é o que esse recurso tem a nos oferecer para resolver o problema das idades. Vamos lá…</p>

<p>Olhando para o este recurso veremos que juntamente com o nome temos os títulos. Os títulos nos dizem muito, já que podemos induzir se a pessoa é mais jovem ou mais madura com base neles.</p>

<p>Vamos introduzir uma nova técnica para chegar nisso, chamamos essa técnica de <strong>feature engineering</strong>.</p>

<h2 id="feature-engineering">Feature Engineering</h2>

<p>A <strong>engenharia de recurso</strong> tenta aumentar a capacidade de previsão dos algoritmos de aprendizado criando recursos de dados brutos que facilitam o processo de aprendizado. Basicamente esse processo tenta criar outros recursos relevantes com base nos recursos brutos existentes nos dados e aumentar a capacidade de previsão do algoritmo de aprendizado.</p>

<p>Vamos continuar na análise dos nossos recursos agora aplicando um exemplo de feature engineering.</p>

<h4 id="title">Title</h4>

<p>Como vimos, temos junto aos nomes os <strong>títulos de tratamento</strong> para cada pessoa. Sendo assim podemos agregar a nossa estratégia de idade a indução da mesma com base no título.</p>

<p>Neste caso vamos extrair o título do nome e encontrar a média entre idade e o título informado, e depois substituir os <strong>valores missing</strong> pela média correspondente. Essa estratégia serve para ajudar a evitar substituir o valor missing de uma possível criança pela idade de um adulto. Assim diminuímos a margem de erro no tratamento de dados missing, e obtemos um resultado final eficiente.</p>

<p>Extrair e cruzar os dados de idade com os dados do título de treinamento é um exemplo de <strong>Feature Engineering</strong>, que visa tornar o conjunto de dados mais rico para o aprendizado.</p>

<p>Traduzindo isso em código, nossa primeira tarefa será criar uma coluna chamada <strong>Title</strong> e extrair o valor do título de tratamento para inserir o valor nela.</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 mergedTitanicDS['Title'] = [nameStr[1].strip().split('.')[0] for nameStr in
 mergedTitanicDS['Name'].str.split(',')]
    </code>
</pre>

<p>Para visualizar a importância desse novo recurso, vamos olhar a distribuição deste dado. No código abaixo geramos uu gráfico que exibe uma visão interessante da distribuição dos títulos distintos em nosso dataset. Alguns dos títulos refletem Realeza, como por exemplo Jonkheer, que é título de nobreza holandesa.</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 mergedTitanicDS['Title'].value_counts().plot.bar()
    </code>
</pre>

<p align="center"><img src="http://blob.vitormeriat.com.br/images/2017/03/18/feature engineering-title.png" /></p>

<p>Sendo assim podemos analizar melhor nossa decisão. Como a grande maioria dos dados são representados pelo título <code>Mr</code>, e temos 18 títulos diferentes, sendo assim já sabemos de cara que seria um erro ter uma média generalizada.</p>

<p>Vamos traduzir isso para código. Abaixo temos os 4 passos para o nosso objetivo:</p>

<ol>
  <li>Agregamos a idade pelo título e aplicamos a média;</li>
  <li>Como será gerada uma nova coluna, vamos renomeá-la para Title;</li>
  <li>Realizamos o merge da nova coluna em nosso dataset;</li>
  <li>Substituímos os valores missing pela média de cada título.</li>
</ol>

<pre style="font-size: 1.2em !important">
    <code class="python">
 # 1
 aggAgeByTitleDS = mergedTitanicDS[['Age','Title']].groupby(['Title']).mean().reset_index()

 # 2
 aggAgeByTitleDS.columns = ['Title','Mean_Age']

 # 3
 mergedTitanicDS_Merged = pd.merge(mergedTitanicDS, aggAgeByTitleDS,on="Title")

 # 4
 mergedTitanicDS_Merged.loc[mergedTitanicDS_Merged['Age'].isnull(),'Age']=mergedTitanicDS_Merged[mergedTitanicDS_Merged['Age'].isnull()]['Mean_Age']
    </code>
</pre>

<h4 id="cabin">Cabin</h4>

<p>Vamos evoluir em nossa análise. A feature <strong>cabin</strong> parece ser o maior problema, ele é parece ser realmente complexo. Para começar ele represente mais de 70% dos dados missing em nosso dataset.</p>

<p>Não há muito o que os dados da cabine possam oferecer em relação ao nosso problema. Nada que revele uma predisposição a sobrevivência ou não, algo como a relação de proximidade com o assidente ou coisa do tipo. Como não temos informação adicional ou externa sobre este recurso, uma estratégia que podemos utilizar é criar um novo recurso indicando a existência ou não da cabine.</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 mergedTitanicDS['IsCabinDataEmpty'] = 0
 mergedTitanicDS.loc[mergedTitanicDS['Cabin'].isnull(),'IsCabinDataEmpty'] = 1
    </code>
</pre>

<h4 id="surname">Surname</h4>

<p>Outro dado que podemos extrair e que será de extrema importância é o sobrenome do passageiro. Com este dado em mãos podemos realizar uma combinação posterior para inferir as famílias que estavam no Titanic. Podemos resolver isso com apenas uma linha de código.</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 mergedTitanicDS_Merged['Surname'] = [nameStr[0].strip() for 
 	nameStr in mergedTitanicDS_Merged['Name'].str.split(',')]
    </code>
</pre>

<p>Agora, qual a importância dessa ação? Aqui vai mais uma dica: Procure avaliar cada nova <code>feature</code> possível. Isso é de suma importância, já que posteriormente conseguimos avaliar se existe ou não alguma relação deste novo recurso e nossa meta.</p>

<p>Agora já temos o sobrenome, mas isso pode acabar sendo outra armadilha, uma vez que é possível termos passageiros com o mesmo sobrenome e que não sejam da mesma família. Para isso vamos tentar melhorar nossa combinação de dados…</p>

<h4 id="family-size">Family Size</h4>

<p>Algo que pode nos ajudar nesse sentido é descobrir o tamanho da família. Udsando as features <code>SibSp</code> que representa a quantidade de irmãos e cônjuges, e <code>Parch</code> que representa a quantidade de pais e filhos, podemos inferir nosso <strong>Family Size</strong>.</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 mergedTitanicDS_Merged['FamilySize'] = 
 	mergedTitanicDS_Merged['SibSp'] + mergedTitanicDS_Merged['Parch'] + 1
    </code>
</pre>

<h2 id="data-transformation">Data Transformation</h2>

<p>Antes de prosseguirmos, vamos avalidar todos os recursos que criamos e o que já tinhamos a nossa disposição:</p>

<pre style="font-size: 1.4em !important">
    <code class="python">
 mergedTitanicDS_Merged.dtypes
    </code>
</pre>

<p>O resultado será o seguinte:</p>

<pre><code>PassengerId           int64
Pclass                int64
Name                 object
Sex                  object
Age                 float64
SibSp                 int64
Parch                 int64
Ticket               object
Fare                float64
Cabin                object
Embarked             object
Survived              int64
IsCabinDataEmpty      int64
Title                object
Mean_Age            float64
Surname              object
FamilySize            int64
</code></pre>

<p>Observe os campos cujo o tipo são <code>object</code>:</p>

<ul>
  <li>Name</li>
  <li>Sex</li>
  <li>Ticket</li>
  <li>Cabin</li>
  <li>Embarked</li>
  <li>Title</li>
</ul>

<p>Para realizarmos nosso algorítimo de forma satisfatória, precisamos “adequar” nossos dados. A priori já sabemos que para trabalhar com estatística consideramos dois tipos de dados: <strong>numérico</strong> ou <strong>categórico</strong>.</p>

<blockquote>
  <p><strong>Nota</strong>: Uma descrição detalhada pode ser encontrada em meu post <a href="http://www.vitormeriat.com.br/2017/04/20/variables-in-statistic/">Variáveis, Estatística e Macnhine Learning</a>.</p>
</blockquote>

<p>Sendo assim vamos aplicar alguma transformação para estes dados a fim de torná-los compativeis que nosso algorítimo.</p>

<h4 id="sex-embarked-and-title">Sex, Embarked and Title</h4>

<p>Temos apenas dois tipos possíveis para sexo: Masculino e Feminino. Esta é uma tranformação simples, já que se trata de uma opção binária. Seguindo esta linha vamos <code>codificar</code> essa feature para que consigamos realizar uma representação onde para cara linha tenhamos uma coluna <code>male</code> e <code>female</code> onde necessáriamente um será positivo (1) e o outro negativo (0).</p>

<pre style="font-size: 1.4em !important">
    <code class="python">
 pd.get_dummies(mergedTitanicDS_Merged['Sex'])
    </code>
</pre>

<p>Teremos como resultado a seguinte saída:</p>

<p>FIG sex</p>

<p>O mesmo conseito pode ser aplicado para <strong>Embarked</strong> e <strong>Title</strong>:</p>

<p>FIG embarked</p>

<p>FIG title</p>

<p>Utilizando o <strong>Pandas</strong> vamos realizar a transformação dos dados categóricos em tipos que possam ser expressos de forma númerica. Logo após fazemos o merge das novas informações em nosso <strong>DataFrame</strong>.</p>

<pre style="font-size: 1.2em !important">
    <code class="python">
 mergedTitanicDS_Merged = pd.concat([mergedTitanicDS_Merged,
 	pd.get_dummies(mergedTitanicDS_Merged['Embarked'])],axis = 1)
 
 mergedTitanicDS_Merged = pd.concat([mergedTitanicDS_Merged,
 	pd.get_dummies(mergedTitanicDS_Merged['Sex'])],axis = 1)
 	
 mergedTitanicDS_Merged = pd.concat([mergedTitanicDS_Merged,
 	pd.get_dummies(mergedTitanicDS_Merged['Title'])],axis = 1)
    </code>
</pre>

<p>Agora uma coisa pode parecer parecer estranha neste processo. Estamos incluindo um grande número de recursos, o que geralmente é bom para nos dar mais massa de manobra na exploração de relações com nosso alvo. O efeito colateral é que também pode trazer confusão se não for algo bem elaborado.</p>

<blockquote>
  <p><strong>Nota</strong>: Variáveis categóricas são conhecidas por ocultar e mascarar muitas informações interessantes em um conjunto de dados. É crucial aprender os métodos de lidar com essas variáveis.</p>
</blockquote>

<h2 id="feature-selection">Feature Selection</h2>

<p>A seleção de recursos também é chamada seleção de variáveis (variable selection) ​​ou seleção de atributos (attribute selection). Esta técnica se resume em saber selecionar quis os atributos em seus dados são realmente relevantes para a modelagem preditiva que você está construindo.</p>

<p>Sendo assim, vamos analisar o que temos de atributos, e ver se precisamos ou não de todos eles para a construção do nosso modelo.</p>

<hr style="margin-bottom: 4em; margin-top: 6em;" />

<h1 id="o-repositório">O repositório</h1>

<p>Você pode olhar o código completo acessando o mesmo no repositório <strong>Meriat Machine Learning Notes</strong> no meu Github.</p>

<p><a href="https://github.com/vitormeriat/meriat-ml-notes/blob/master/Titanic%20-%20Machine%20Learning%20from%20Disaster.ipynb">Titanic: Machine Learning from Disaster</a></p>

<div style="margin-bottom: 5em;"></div>

<h1 id="referências">Referências</h1>
<ul>
  <li><a href="https://www.kaggle.com/c/titanic">Titanic: Machine Learning from Disaster</a></li>
  <li><a href="http://trevorstephens.com/kaggle-titanic-tutorial/getting-started-with-r/">Titanic: Getting Started With R</a></li>
</ul>

    </section>
  </article>

  <hr/>
  <section class="author">
  	<header> <a href=""> <img class="profile" src="/assets/images/profile.jpg" alt="Author's profile picture"></a></header>
  	<article>
  		<!-- Author Name -->
      	<h4>  </h4>
      	<!-- Author Bio -->
      	<p>
      		Vitor is a computer scientist who is passionate about creating software that will positively change the world we live in.
      	</p>
        <p>
          MVP Azure - Cloud Architect - Data science enthusiast
        </p>
      </article>
  </section>
  <hr/>

  <div style="margin-top: 60px; margin-bottom: 60px;">
    
    
      18 minutes to read
    
  </div>

  <div class="PageNavigation">
  
    <a class="prev" href="/2017/02/15/apresentando-meriat-ml-notes/"><i class="fa fa-lg fa-arrow-left"></i> Apresentando o Meriat Machine Learning Notes</a>
  
  
    <a class="next" href="/2017/04/01/devopssummitbrasil-azure-cognitive-services/">Devops Summit Brasil 2017 - Minha palestra sobre Azure Cognitive Services <i class="fa fa-lg fa-arrow-right"></i></a>
  
  </div>
</div>
<div style="height: 80px;"></div>

    </main>

    <footer id="fh5co-footer" role="contentinfo">
	<div class="container">
		<div class="row">
			<div class="col-md-12" style="text-align: right;">
				<ul class="fh5co-footer-social">
					<li><a href="https://twitter.com/vitormeriat" target="_blank"><i class="fa fa-twitter fa-1x"></i> Twitter</a></li>
					<li><a href="https://github.com/vitormeriat" target="_blank"><i class="fa fa-github fa-1x"></i> Github</a></li>
					<li><a href="https://www.linkedin.com/in/vitormeriat" target="_blank"><i class="fa fa-linkedin fa-1x"></i> LinkedIn</a></li>
					<li><a href="https://www.instagram.com/vitormeriat/" target="_blank"><i class="fa fa-instagram fa-1x"></i> Instagram</a></li>
					<li><a href="https://www.facebook.com/vitormeriat/" target="_blank"><i class="fa fa-facebook fa-1x"></i> Facebook</a></li>
					<li><a href="https://www.youtube.com/user/vitormeriat/" target="_blank"><i class="fa fa-youtube fa-1x"></i> Youtube</a></li>
				</ul>
				<p class="fh5co-copyright">
					<small>(c) 2017 <a href="/">Meriat's</a>. All Rights Reserved.
					</small>
				</p>
			</div>
		</div>
	</div>
</footer>

	<!-- Go To Top -->
	<a href="#" class="fh5co-gotop"><i class="ti-shift-left"></i></a>

	<!-- jQuery -->
	<script src="/assets/js/jquery-1.10.2.min.js"></script>
	<!-- jQuery Easing -->
	<script src="/assets/js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="/assets/js/bootstrap.js"></script>
	<!-- Owl carousel -->
	<script src="/assets/js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
 <script src="/assets/js/jquery.magnific-popup.min.js"></script>
	<!-- Easy Responsive Tabs -->
	<script src="/assets/js/easyResponsiveTabs.js"></script>
	<!-- FastClick for Mobile/Tablets -->
	<script src="/assets/js/fastclick.js"></script>
	<!-- Velocity -->
	<script src="/assets/js/velocity.min.js"></script>
	<!-- Main JS -->
	<script src="/assets/js/main.js"></script>


  </body>
</html>
