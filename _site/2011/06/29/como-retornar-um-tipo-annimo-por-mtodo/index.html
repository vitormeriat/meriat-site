<!DOCTYPE html>
<html>

  ﻿<head>
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-90757610-1', 'auto');
    ga('send', 'pageview');
  </script>

  <script type="text/javascript">
  var appInsights=window.appInsights||function(config){
    function i(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},u=document,e=window,o="script",s="AuthenticatedUserContext",h="start",c="stop",l="Track",a=l+"Event",v=l+"Page",y=u.createElement(o),r,f;y.src=config.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js";u.getElementsByTagName(o)[0].parentNode.appendChild(y);try{t.cookie=u.cookie}catch(p){}for(t.queue=[],t.version="1.0",r=["Event","Exception","Metric","PageView","Trace","Dependency"];r.length;)i("track"+r.pop());return i("set"+s),i("clear"+s),i(h+a),i(c+a),i(h+v),i(c+v),i("flush"),config.disableExceptionTracking||(r="onerror",i("_"+r),f=e[r],e[r]=function(config,i,u,e,o){var s=f&&f(config,i,u,e,o);return s!==!0&&t["_"+r](config,i,u,e,o),s}),t
    }({
        instrumentationKey:"d4823b90-66dc-43d1-84c6-7da8a3796ebd"
    });
    window.appInsights=appInsights;
    appInsights.trackPageView();
</script>

  <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Vitor Meriat</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Vitor Meriat" />
	<meta name="keywords" content="cloud computing, machine learning, big data, iot, developer, data scientist" />
	<meta name="author" content="Vitor Meriat" />

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="/assets/favicon.ico">

	<!-- Google Webfont -->
	<link href='https://fonts.googleapis.com/css?family=PT+Mono' rel='stylesheet' type='text/css'>
	<!-- Themify Icons -->
	<link rel="stylesheet" href="/assets/css/themify-icons.css">
	<!-- Icomoon Icons -->
	<link rel="stylesheet" href="/assets/css/icomoon-icons.css">
	<!-- Bootstrap -->
	<link rel="stylesheet" href="/assets/css/bootstrap.css">
	<!-- Owl Carousel -->
	<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
	<link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
	<!-- Magnific Popup -->
	<link rel="stylesheet" href="/assets/css/magnific-popup.css">
	<!-- Easy Responsive Tabs -->
	<link rel="stylesheet" href="/assets/css/easy-responsive-tabs.css">
	<!-- Theme Style -->
	<link rel="stylesheet" href="/assets/css/style.css?v1">

	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
	<link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/obsidian.css">

	<script>hljs.initHighlightingOnLoad();</script>

	<!-- FOR IE9 below -->
	<!--[if lte IE 9]>
	<script src="js/modernizr-2.6.2.min.js"></script>
	<script src="js/respond.min.js"></script>
	<![endif]-->
</head>


  <body>
    <!-- Header -->
	<header id="fh5co-header" role="banner">
		<div class="container">
      <div id="fh5co-logo">
				<a href="/">
					<img src="/assets/images/logo-d.png" alt="Work Logo">
				</a>
			</div>
      <div style="text-align: center;">
        <a href="/"><h2 style="margin-top: 0px !important;">Vitor Meriat</h2></a>
        <span style="font-size: 1em; color: black;">MVP Azure - Cloud Architect - Data science enthusiast</span>
      </div>
			<!-- Mobile Toggle Menu Button -->
			<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>

			<!-- Main Nav -->
			<div id="fh5co-main-nav">
				<nav id="fh5co-nav" role="navigation">
					<ul>
						<li class="">
							<a href="/">Blog</a>
						</li>
						<li class="">
							<a href="/archive/">Archives</a>
						</li>
            <li class="">
							<a href="/category/">Categories</a>
						</li>
            <li class="">
							<a href="/about/"> About me </a>
						</li>
					</ul>
					<!-- <a href="http://www.vitormeriat.com.br/" target="_blank" class="fh5co-nav-call-to-action js-fh5co-nav-call-to-action">Blog</a> -->
          <!-- <a href="/about/" class="">About me</a> -->
				</nav>
			</div>
			<!-- Main Nav -->
		</div>
	</header>
	<!-- Header -->
    <main role="main">
      <div class="container">
  <article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="row">
      <div class="fh5co-spacer fh5co-spacer-sm"></div>
      <div class="col-md-12 text-center">
        <h1>Como retornar um tipo anônimo por método</h1>
        
      </div>
      
        <h2 class="fh5co-uppercase-heading-sm text-center">
          C#
        </h2>
      
      <span><time datetime="2011-06-29T00:00:00-03:00" itemprop="datePublished">Jun 29, 2011</time></span>
    </div>
    <div class="fh5co-spacer fh5co-spacer-md"></div>
    <section class="section-padding post" itemprop="articleBody">
      <p>Os tipos anônimos são muito uteis principalmente quando estamos trabalhando com LINQ. Podemos filtrar uma lista de campos para um resultado projetando um tipo personalizado. Usar um tipo anônimo pode ser muito mais rápido que criar um novo tipo.</p>

<p>No post <a href="http://vitormeriat.com.br/2011/06/09/tipos-annimos-so-realmente-teis/" target="_blank">Tipos anônimos são realmente úteis?</a>, falei sobre os tipos anônimos, suas limitações e como este recurso é útil. Um dos pontos abordados foi sobre as limitações dos tipos anônimos. Vou reproduzir o texto em questão:</p>

<blockquote>
  <p>Os tipos anônimos apresentam limitações que devem ser conhecidas para que seu uso possa ser mais consciente. Quando se opta por usar tipos anônimos é necessário saber que eles não são símbolos C# válidos, sua validade fica a nível de CLR. Isto implica na impossibilidade de definir métodos de extensão, de declarar métodos com tipos anônimos como parâmetros e retornar tipos anônimos a partir de métodos.</p>
</blockquote>

<p>Vamos analisar o código abaixo:</p>

<p align="justify"><a href="http://blob.vitormeriat.com.br/images/2011/06/tiposanonimos01.png"><img alt="tiposAnonimos01" src="http://blob.vitormeriat.com.br/images/2011/06/tiposanonimos01.png" /></a></p>

<p align="justify">Este código cria uma nova instância de um tipo anônimo. É possível notar que que o compilador C# é capaz de inferir os tipos como visto no <strong>Intellisense</strong>. Depois de ter declarado o tipo você pode usá-lo como se houvesse feito uma declaração de tipo normal. O compilador C# atribui o tipo adequado para cada propriedade. Esta atribuição não se limita a valores literais, pode ser uma expressão de valor ou tipos aninhados como no exemplo a seguir: </p>

<pre style="font-size: 16pt !important">
<code class="cs">
var Cliente = new
{
    Empresa = "Sr.Nimbus",
    Name = "Vitor Merat",
    Admissao = new DateTime(2011, 01, 01),
    Idade = 26,
    Contatos = new
    {
        Telefone = "61 3121-1211",
        Fax = "61 3231-1211",
        Email = "vitormeriat@srnimbus.com.br"
    }
};
</code>
</pre>

<p>Dentro do escopo do método local, o compilador entende toda a semântica do tipo. Isto tudo é muito legal mas como já foi dito o tipo anônimo é desconhecido fora do método que o criou. Não há nada de tão especial sobre este tipo - é simplesmente uma instância de um tipo de referência. A única coisa diferente sobre esse tipo é que ele tem um nome que você não pode ver.</p>

<p>Esta é uma situação em que é necessário usar a palavra-chave var. Como não sabemos qual o nome do tipo, usamos a palavra-chave var, e deixamos com o compilador a missão de inferir o tipo.</p>

<p>Então se um tipo é anônimo, como podemos fazer para que um método possa retorná-lo?</p>

<pre style="font-size: 16pt !important">
<code class="cs">
public ????? ListaDeClientes()
{
    var q1 = from c in contexto.Clientes
        where c.Cidade == "Brasília"
        select new { c.PrimeiroNome, c.UltimoNome, c.Cidade };
        
    return q1;
};
</code>
</pre>

<p>Se você quiser retornar um objeto a partir de um método, você deve declarar o método para retornar um objeto deste tipo. Isto está bem claro na semântica do C#, para chegarmos ao fim desejado devemos tornar nosso tipo anônimo em um tipo nominal.</p>

<p>Não podemos retornar um <strong><font size="2">var</font></strong>, então para ser mais genérico o mais recomendado é utilizar um <strong><font size="2">object</font></strong> para o retorno. Se um um tipo anônimo é um tipo do .NET, então esse herda de <strong>System.Object</strong>, logo podemos retornar um object. Isto pode funcionar em alguns casos mais certamente você será surpreendido com impossibilidades nesta abordagem.</p>

<pre style="font-size: 16pt !important">
<code class="cs">
public object ListaDeClientes()
{
    var q1 = from c in contexto.Clientes
        where c.Cidade == "Brasília"
        select new { c.PrimeiroNome, c.UltimoNome, c.Cidade };
        
    return q1;
};
</code>
</pre>

<p>O raciocínio está correto, porém quando o tipo é transformado para object, perdemos a possibilidade de utilização das propriedades do tipo anônimo (<strong>strong typing</strong>).</p>

<blockquote>
  <p>Strong Typing: É uma caracteristica das linguagens de programação, onde não é permitida a modificação do tipo de dados de uma variável durante a execução dos programas.</p>
</blockquote>

<p align="center"><a href="http://blob.vitormeriat.com.br/images/2011/06/tiposanonimos05.png"><img alt="tiposAnonimos05" src="http://blob.vitormeriat.com.br/images/2011/06/tiposanonimos05.png" /></a></p>

<p>Este erro ocorre porque quando criamos um tipo anônimo, suas propriedades são <strong>READ ONLY</strong>. Isto significa que você pode criar o tipo anônimo, mas você não pode atribuir valores a ele após sua criação.</p>

<p align="justify">Para resolver esse problema temos 3 estratégias possíveis:</p>
<ol>
<ol>
<li>
<div align="justify">Reflection; </div>
</li>
<li>
<div align="justify">Dynamic Programming; </div>
</li>
<li>
<div align="justify">Realizar um cast do object com o tipo anônimo.</div>
</li>
</ol>
</ol>

<p align="justify">Trabalhar com <strong>reflection</strong> é bastante pesaroso sem falar nas questões de desempenho, trabalhar com programação dinâmica é bem legal mais como ainda não postei sobre este tema vamos nos ater a terceira estratégia.</p>

<p align="justify">Vejamos o código abaixo:</p>

<p><a href="http://blob.vitormeriat.com.br/images/2011/06/tiposanonimos06.png"><img alt="tiposAnonimos06" src="http://blob.vitormeriat.com.br/images/2011/06/tiposanonimos06.png" /></a></p>

<script src="https://gist.github.com/vitormeriat/eb68005cc53f307068b3bf5b53b06cbd.js"></script>

<p>Utilizando todo o poder dos <strong>Generics</strong>, conseguimos montar um método <strong>ConverteTiposPara</strong> que realiza o cas de um object para um tipo anônimo. Graças a “inferência de tipo” é possível fazer um cast sem conhecer o nome do tipo.</p>

<p>&nbsp;</p>

<p>Baixar o Código Fonte do Artigo <a href="https://skydrive.live.com/?wa=wsignin1.0&amp;cid=bd055aa47a388023&amp;sc=documents#cid=BD055AA47A388023&amp;id=BD055AA47A388023%21125" target="_blank">aqui!</a></p>

<p>&nbsp;</p>

<h3>Links de ajuda:</h3>
<p>Anonymous Types (C# Programming Guide)<strong>&nbsp;&nbsp; </strong><a href="http://bit.ly/69HYJd">http://bit.ly/69HYJd</a></p>
<p>&nbsp;</p>

<h3 id="um-grande-abraço-e-ótimo-estudo">Um grande abraço e ótimo estudo!</h3>

    </section>
  </article>

  <hr/>
  <section class="author">
  	<header> <a href=""> <img class="profile" src="/assets/images/profile.jpg" alt="Author's profile picture"></a></header>
  	<article>
  		<!-- Author Name -->
      	<h4>  </h4>
      	<!-- Author Bio -->
      	<p>
      		Vitor is a computer scientist who is passionate about creating software that will positively change the world we live in.
      	</p>
        <p>Share this post: <a href="http://twitter.com/share?text=Como retornar um tipo anônimo por método&amp;url=http://localhost:4000/2011/06/29/como-retornar-um-tipo-annimo-por-mtodo/"
          target="_blank"><i class="fa fa-twitter fa-1x"></i> Twitter</a> - 
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2011/06/29/como-retornar-um-tipo-annimo-por-mtodo/"
            target="_blank"><i class="fa fa-facebook fa-1x"></i> Facebook</a></p>
      </article>
  </section>
  <hr/>

  <div style="margin-top: 60px; margin-bottom: 60px;">
    
    
      4 minutes to read
    
  </div>

  <div class="PageNavigation">
  
    <a class="prev" href="/2011/06/24/charge-da-semana-a-histria-da-nuvem-parte-1/"><i class="fa fa-lg fa-arrow-left"></i> Charge da Semana: A história da Nuvem - Parte 1</a>
  
  
    <a class="next" href="/2011/07/01/charge-da-semana-conceitos-de-cloud-computing/">Charge da Semana: Conceitos de Cloud Computing <i class="fa fa-lg fa-arrow-right"></i></a>
  
  </div>
</div>
<div style="height: 80px;"></div>

    </main>

    <footer id="fh5co-footer" role="contentinfo">
		<div class="container">
			<div class="row">
				<div class="col-md-push-6 col-md-9">
					<ul class="fh5co-footer-social">
						<li><a href="https://twitter.com/vitormeriat" target="_blank"><i class="fa fa-twitter fa-1x"></i> Twitter</a></li>
						<li><a href="https://github.com/vitormeriat" target="_blank"><i class="fa fa-github fa-1x"></i> Github</a></li>
						<li><a href="https://www.linkedin.com/in/vitormeriat" target="_blank"><i class="fa fa-linkedin fa-1x"></i> LinkedIn</a></li>
						<li><a href="https://www.instagram.com/vitormeriat/" target="_blank"><i class="fa fa-instagram fa-1x"></i> Instagram</a></li>
						<li><a href="https://www.facebook.com/vitormeriat/" target="_blank"><i class="fa fa-facebook fa-1x"></i> Facebook</a></li>
					</ul>
					<p class="fh5co-copyright">
						<small>(c) 2017 <a href="/">Meriat's</a>. All Rights Reserved.
						</small>
					</p>
				</div>
			</div>
		</div>
	</footer>

	<!-- Go To Top -->
	<a href="#" class="fh5co-gotop"><i class="ti-shift-left"></i></a>

	<!-- jQuery -->
	<script src="/assets/js/jquery-1.10.2.min.js"></script>
	<!-- jQuery Easing -->
	<script src="/assets/js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="/assets/js/bootstrap.js"></script>
	<!-- Owl carousel -->
	<script src="/assets/js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
 <script src="/assets/js/jquery.magnific-popup.min.js"></script>
	<!-- Easy Responsive Tabs -->
	<script src="/assets/js/easyResponsiveTabs.js"></script>
	<!-- FastClick for Mobile/Tablets -->
	<script src="/assets/js/fastclick.js"></script>
	<!-- Velocity -->
	<script src="/assets/js/velocity.min.js"></script>
	<!-- Main JS -->
	<script src="/assets/js/main.js"></script>


  </body>
</html>
