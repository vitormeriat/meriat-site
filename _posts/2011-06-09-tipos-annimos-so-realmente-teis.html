---
layout: post
title: Tipos anônimos são realmente úteis?
date: 2011-06-09 11:22:05.000000000 -03:00
type: post
published: true
status: publish
categories:
- C#
- CLR
---
<p align="justify">Os tipos anônimos (Anonymous Types) são uma característica da linguagem C# onde criamos diversas propriedades para um objeto sem ter que definir explicitamente seu tipo. Essa novidade surgiu na versão 3.0 junto com diversas outras tais como: propriedades automáticas, inferência de tipos, inicializadores de objetos, expressões lambda, métodos de extensão dentre outros.</p>
<p align="justify">A referência para tipos anônimos na MSDN diz que tipos anônimos fornecem uma maneira conveniente de encapsular um conjunto de propriedades apenas leitura em um simples objeto sem que seja necessário primeiro definir explicitamente um tipo. O nome do tipo é gerado pelo compilador e não está disponível no nível do código fonte. <strong>O tipo das propriedades é inferido pelo compilador</strong>.</p>
<p align="justify"><font size="3">U</font>m tipo anônimo pode ser declarado da seguinte maneira:</p>
<p align="justify"><a href="https://meriatsite.blob.core.windows.net/images/2011/06/001_thumb2.png"><img style="background-image:none;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;margin-right:auto;padding-top:0;border-width:0;" title="001_thumb2" border="0" alt="001_thumb2" src="{{ site.baseurl }}/assets/001_thumb2_thumb.png" width="482" height="101" /></a></p>
<p align="justify"><font size="3">N</font>este caso a variável tipoAnonimo é um tipo anônimo que possui três propriedades: </p>
<p><!--more-->
<ol>
<li>
<div align="justify">Nome do tipo System.String;</div>
</li>
<li>
<div align="justify">Idade do tipo System.Int32;</div>
</li>
<li>
<div align="justify">Altura do tipo System.Double.</div>
</li>
</ol>
<p align="justify"><font size="3">O</font>s tipo anônimos são muito úteis quando realizamos consultas usando o LINQ uma vez que normalmente temos que retornar um tipo com o conjunto de propriedades diferentes dos tipos já existentes. Vamos realizar algumas consultas para exemplificar esta assertiva:</p>
<p align="justify"><a href="https://meriatsite.blob.core.windows.net/images/2011/06/002_thumb3.png"><img style="background-image:none;padding-left:0;padding-right:0;display:block;float:none;margin-left:auto;margin-right:auto;padding-top:0;border-width:0;" title="002_thumb3" border="0" alt="002_thumb3" src="{{ site.baseurl }}/assets/002_thumb3_thumb.png" width="482" height="261" /></a>&nbsp;</p>
<p align="justify"><font size="3">A</font> primeira consulta retorna um tipo que contém três propriedades(Nome, Empresa e Linguagem) e no segundo exemplo obtemos um tipo com apenas uma propriedade( Empresa). Sem o recuso dos tipos anônimos teríamos que definir explicitamente a classe para representar os tipos retornados.</p>
<blockquote><p align="justify">Quando um tipo anônimo é atribuído a uma variável, a variável deve ser inicializada com a construção <a href="http://msdn.microsoft.com/pt-br/library/bb383973.aspx">var</a>. Isso ocorre porque apenas o compilador tem acesso ao nome base do tipo anônimo. </p>
</blockquote>
<p align="justify"><font size="3">Q</font>uando criamos um tipo anônimo o compilador gera uma classe selada interna que modela o tipo . O tipo anônimo é imutável: todas as suas propriedades estão no modo somente leitura. Essa classe contém substituições de Equals() e GetHashCode() que implementam a semântica de valores. Além disso, o compilador gera uma substituição de ToString(), que exibe o valor de cada uma das propriedades públicas.</p>
<p align="justify">Tipos anônimo são tipos de referência, derivam diretamente de <strong>object</strong>. Durante sua criação o compilador lhe atribui um nome que é inacessível para a aplicação. Da perspectiva do CLR, um tipo anônimo não é diferente de qualquer outro tipo por referência, exceto pelo fato de não poder ser convertido para qualquer tipo.</p>
<p align="justify">&nbsp;</p>
<h2 align="justify">Limitações</h2>
<p align="justify">Os tipos anônimos apresentam limitações que devem ser conhecidas para que seu uso possa ser mais consciente. Quando se opta por usar tipos anônimos é necessário saber que eles não são símbolos C# válidos, sua validade fica a nível de CLR. Isto implica na impossibilidade de definir métodos de extensão, de declarar métodos com tipos anônimos como parâmetros e retornar tipos anônimos a partir de métodos.</p>
<p align="justify">&nbsp;</p>
<h2 align="justify">Resposta</h2>
<p align="justify">É certo que os tipos anônimos tem limitações, então qual sua real utilidade? </p>
<p align="justify">Penso que a utilização de tipos anônimos(sempre com o uso do bom senso) é muito vantajosa pelos seguintes pontos:</p>
<ul>
<li>
<div align="justify">O compilador escreve os códigos muito mais rápido que você! Ele cria um calhamaço de código para cada tipo anônimo que criamos; </div>
</li>
<li>
<div align="justify">É uma ótima maneira de economizar tempo (Time is money);</div>
</li>
<li>
<div align="justify">Não destroem o desing da aplicação. São uma excelente alternativa para valores locais desafogando a necessidade que muitas vezes se tinha de criar uma classe para se trabalhar com os retornos;</div>
</li>
<li>
<div align="justify">Por serem anônimos podem seu utilizados para trazer um maior desacoplamento, separando lógicas específicas sem a dependência de tipos já definidos.</div>
</li>
</ul>
<p align="justify">Existem algumas estratégias que possibilitam um uso mais apurado dos tipos anônimos. Mais isto fica para o próximo post.</p>
<p>Baixo e código fonte do post <a href="httpcid-bd055aa47a388023.office.live.comself.aspx.PublicTiposAnonimos.rar" target="_blank">aqui</a>!</p>
<p>&nbsp;</p>
<h4></h4>
<h3>Um grande abraço e ótimo Estudo!</h3>
<p><a href="https://meriatsite.blob.core.windows.net/images/2011/03/logo.jpg"><img style="display:inline;float:left;" title="logo" border="0" alt="logo" align="left" src="{{ site.baseurl }}/assets/logo_thumb.jpg?w=50&amp;h=98&amp;h=98" width="50" height="98" /></a><strong>&nbsp;&nbsp;&nbsp;&nbsp; Twitter: <a href="http://twitter.com/vitormeriat">@vitormeriat</a></strong><br />&nbsp;&nbsp;&nbsp;&nbsp; <a href="mailto:vitormeriat@gmail.com">vitormeriat@gmail.com</a><br />&nbsp;&nbsp;&nbsp;&nbsp; <a href="mailto:vitor.pereira@studentpartners.com.br">vitor.pereira@studentpartners.com.br</a></p>
