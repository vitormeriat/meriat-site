---
layout: post
title: CloudStorageAccount e o método SetConfigurationSettingPublisher
date: 2011-05-25
categories:
  - Cloud Computing
  - Microsoft Azure
  - Microsoft Azure Storage
---
<p align="justify">Aqueles que estão estudando ou trabalhando como Azure certamente já tiveram de obter as credenciais da conta de armazenamento. Neste momento você recorre ao Windows Azure Platform Training Kit e os ainda poucos artigos que tratam do assunto.</p>
<p align="justify">Provavelmente o código que você vai encontrar será este(do próprio WAPTK):</p>
<p><a href="https://meriatsite.blob.core.windows.net/images/2011/05/013.png"><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;" title="01" border="0" alt="01" src="{{ site.baseurl }}/assets/01_thumb3.png" width="482" height="99" /></a></p>
<p align="justify">Confesso que não sou um usuário assíduo dos delagates mas uma declaração que envolve um delegate Func(T1, T2) , dentro de outro, Action(T1,T2) para mim já é preciosismo…</p>
<p align="justify">A falta de objetividade e clareza na documentação do Azure (o que com certeza irá mudar) aliado a esta sintaxe nada amigável (e que fique bem claro que nem sempre soluções extremamente elegantes são as melhores) cria uma espécie de antipatia para alguns desenvolvedores.</p>
<p><!--more-->
<p align="justify">Em resumo, você está invocando um método que espera um método que utiliza um método como um parâmetro. Sei que isto parece confuso então vamos explorar a expressão lambda para entendermos melhor qual a utilização deste método:</p>
<ol>
<li>
<div align="justify">O método<a href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.cloudstorageaccount.setconfigurationsettingpublisher.aspx" target="_blank">SetConfigurationSettingPublisher</a> espera um único parâmetro que é do tipo <a href="http://msdn.microsoft.com/en-us/library/018hxwa8.aspx" target="_blank">Action</a>: Action&lt;string,Func&lt;string,bool&gt;&gt;. </div>
</li>
<li>
<div align="justify">Notem que os parâmetros que passados ​​para o nosso método, são uma string (chamada <strong>configName</strong> ) e um Func&lt;string,bool&gt; (chamado <strong>configSettingPublisher</strong>). Em outras palavras, Azure vai retornar o nome da configuração que está sendo recuperado, bem como um método que espera uma string e retorna um valor booleano. </div>
</li>
</ol>
<p align="justify">Neste caso poderíamos fazer sem a expressão Lambda e definir o método como no exemplo abaixo…</p>
<p><a href="https://meriatsite.blob.core.windows.net/images/2011/05/022.png"><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;" title="02" border="0" alt="02" src="{{ site.baseurl }}/assets/02_thumb2.png" width="482" height="255" /></a></p>
<blockquote><p>Para os que ainda não estiverem familiarizados com as expressões Lambda, sugiro a leitura: <a href="http://vitormeriat.wordpress.com/2011/04/20/dissecando-as-expresses-lambda/" target="_blank">Dissecando as expressões Lambda</a></p>
</blockquote>
<p align="justify">Agora no momento que uma chamada é feita para recuperar as credenciais, teremos a execução do método MeuEditorDeConfiguracao.</p>
<p align="justify">Quando utilizamos o método <em>CloudStorageAccount.FromConfigurationSetting</em>, o Azure procura por um editor de configuração. Devido uma chamada anterior a <em>SetConfigurationSettingPublisher, </em>ele encontra o nosso método customizado e utilizando o <em>RoleEnvironment.GetConfigurationSettingValue</em>, nosso código obtém os valores da nossa conta e invoca o método previsto com o parâmetro Func&lt;string, bool&gt;.</p>
<p>No próximo post vamos explorar algumas possibilidades para nossas estratégias de obtenção das credenciais da conta de armazenamento&nbsp; no Azure.</p>
<p><a href="http://cid-bd055aa47a388023.office.live.com/self.aspx/.Public/CredenciaisAzure.rar" target="_blank">Código fonte do Artigo</a></p>
<p><a href="https://meriatsite.blob.core.windows.net/images/2011/03/logo.jpg"><br /><img title="logo" border="0" alt="logo" align="left" src="{{ site.baseurl }}/assets/logo_thumb.jpg?w=50&amp;h=98&amp;h=98" width="50" height="98" /></a><font size="4">Um grande abraço e ótimo estudo!</font></p>
<p><strong>&nbsp;&nbsp; Twitter: <a href="http://twitter.com/vitormeriat">@vitormeriat</a></strong><br />&nbsp;&nbsp;&nbsp; <a href="mailto:vitormeriat@gmail.com">vitormeriat@gmail.com</a><br />&nbsp;&nbsp;&nbsp; <a href="mailto:vitor.pereira@studentpartners.com.br">vitor.pereira@studentpartners.com.br</a></p>
